<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/portfoliosite/component---src-layouts-index-js-d313dda00df17a1a25a0.js" as="script"/><link rel="preload" href="/portfoliosite/component---src-templates-blog-post-js-0862630da6e84a3cedd4.js" as="script"/><link rel="preload" href="/portfoliosite/path---exporting-data-from-a-rails-appliocation-9beab9bf319a505bf6e2.js" as="script"/><link rel="preload" href="/portfoliosite/app-d1edc8033391b9946162.js" as="script"/><link rel="preload" href="/portfoliosite/commons-961887d3f3b2d16d5e81.js" as="script"/><style type="text/css" data-styled-components="kmjnhs gxnCEE gEJmQo dzLRIJ dlDIus gkneu eVTlLN cTSQOX lcKHUK iHdjfC lagtJi gnCkus" data-styled-components-is-local="true">/* sc-component-id: sc-bdVaJa */

.kmjnhs{text-indent:-9999px;overflow:hidden;margin:0;font-size:0;}
/* sc-component-id: sc-bwzfXH */

.gxnCEE{height:5em;margin:0 1rem 0.5rem 1rem;background:url(/portfoliosite/static/logo.150a368a.png);background-position:50% 50%;background-size:contain;background-repeat:no-repeat;}
/* sc-component-id: sc-htpNat */

.gEJmQo{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;max-width:var(--maxwidth);margin:auto;}
@media (max-width:768px){.gEJmQo{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;text-align:center;}}
/* sc-component-id: sc-bxivhb */

.dzLRIJ{margin:0 0 0.5rem 0;padding:0;font-family:arial;text-transform:uppercase;text-decoration:none;color:#9d9d9d;}
/* sc-component-id: sc-ifAKCX */

.dlDIus{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:3px;padding:0;margin:0;}
/* sc-component-id: sc-EHOje */

.gkneu{background-color:#e74c4f;list-style:none;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;height:3px;}
.eVTlLN{background-color:#f0c93d;list-style:none;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;height:3px;}
.cTSQOX{background-color:#8ccfd9;list-style:none;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;height:3px;}
/* sc-component-id: sc-bZQynM */

.lcKHUK{max-width:var(--maxwidth);border-top:1.2px solid var(--greyline);margin:1rem auto;}
@media (max-width:768px){.lcKHUK{margin:1rem;}}
/* sc-component-id: sc-gzVnrw */

.iHdjfC{list-style-type:none;margin:0 auto;padding:0.8rem 0;width:66%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-around;-webkit-justify-content:space-around;-ms-flex-pack:space-around;justify-content:space-around;}
/* sc-component-id: sc-htoDjs */

.lagtJi{padding:0;}
/* sc-component-id: sc-dnqmqq */

.gnCkus{color:var(--greyline);margin:0;font-family:arial;font-size:0.7rem;text-align:center;padding-bottom:0.4rem;}
</style><style type="text/css" data-styled-components="" data-styled-components-is-local="false">/* sc-component-id: sc-global-279589586 */
@import url('https://fonts.googleapis.com/css?family=Open+Sans');
:root{--linkblue:#368bc1;--greyline:#cbcbcb;--maxwidth:820px;}
html{box-sizing:border-box;}
*,*:before,*:after{box-sizing:inherit;}
body{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-size:16px;margin:0;background-color:#dedede;min-width:360px;}
@media (max-width:768px){body{font-size:20px;}}
</style><style type="text/css" data-styled-components="dPZahO" data-styled-components-is-local="true">/* sc-component-id: sc-iwsKbI */

.dPZahO{max-width:1220px;margin:0.3rem auto 0 auto;background-color:#fff;}
@media (max-width:768px){.dPZahO{margin:0 auto;}}
</style><title data-react-helmet="true">MadeByRhys</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><style id="gatsby-inlined-css"></style></head><body><div id="___gatsby"><div class="sc-iwsKbI dPZahO" data-reactroot="" data-reactid="1" data-react-checksum="-533217983"><!-- react-empty: 2 --><div data-reactid="3"><header data-reactid="4"><h1 class="sc-bdVaJa kmjnhs" data-reactid="5">MadeByRhysss</h1><div class="sc-bwzfXH gxnCEE" data-reactid="6"></div></header><nav class="sc-htpNat gEJmQo" data-reactid="7"><a class="sc-bxivhb dzLRIJ" href="/portfoliosite/" data-reactid="8">Home</a><a class="sc-bxivhb dzLRIJ" href="/portfoliosite/about/" data-reactid="9">About me</a><a class="sc-bxivhb dzLRIJ" href="/portfoliosite/blogs/" data-reactid="10">Blogs</a><a class="sc-bxivhb dzLRIJ" href="/portfoliosite/projects/" data-reactid="11">Projects</a><a class="sc-bxivhb dzLRIJ" href="/portfoliosite/contact/" data-reactid="12">Contact</a></nav><ul class="sc-ifAKCX dlDIus" data-reactid="13"><li color="#e74c4f" class="sc-EHOje gkneu" data-reactid="14"></li><li color="#f0c93d" class="sc-EHOje eVTlLN" data-reactid="15"></li><li color="#8ccfd9" class="sc-EHOje cTSQOX" data-reactid="16"></li></ul></div><div data-reactid="17"><h1 data-reactid="18">Exporting data from a Rails&#x27;s Application</h1><div data-reactid="19"><h1>Exporting data from a Rail’s Application</h1>
<p>If you’ve got a Rails Application and want to export information from the database there are many options. We’ll use Rail’s ability to <a href="http://guides.rubyonrails.org/action_controller_overview.html#restful-downloads">respond to different formats</a> within the standard RESTful routes to export data from the Student and School models in the sample app (view the repository <a href="https://github.com/105ron/csv-export">here</a>).</p>
<p>The application is hosted on Heroku <a href="https://export-csv-sample.herokuapp.com/">here</a> and has been seeded with some basic data. Each student ‘belongs_to’ a school which has it’s own model that contains the school’s name and address.</p>
<h3>Export to CSV</h3>
<p>First we will start with exporting a comma separated value file. This file is very simple, can be read by text editors and widely supported so it will allow you to import the data into another application.</p>
<p>The CSV class is now included in the standard Ruby library since ~> 1.9.2 so all we have to do is to ‘require CSV’ within the Rail’s Application. Although it is a simple format, it can be troublesome to save and load data which itself contains quotes and commas.</p>
<p>In the sample application the goal is to save the data in the student model and the rows association data in the school model. To do this we will use the ActiveRecord <a href="http://guides.rubyonrails.org/active_record_querying.html#joins">joins</a> and <a href="http://guides.rubyonrails.org/active_record_querying.html#selecting-specific-fields">select</a> methods to query our database and return our Student::ActiveRecord_Relation.</p>
<iframe src="https://medium.com/media/a5a15a035a2c66c76d5c49de45add7b3" frameborder=0></iframe>
<p>If we open the Rail’s Console and run the code you will notice it does not return the fields from the joined schools table.</p>
<iframe src="https://medium.com/media/477bb7ef1fd537c7ba1def53efdafa77" frameborder=0></iframe>
<p>ActiveRecord will only return items in Student class. To see the fully joined result we would need to open the database. (Postgres in this case and *psql csv-export_development *from the terminal {not the Rail’s console} to open the database, then we can run the raw SQL) We can however check from the console the columns are included in the result by chaining the column name (and including first so we only have one result) onto the end of the method like so…</p>
<iframe src="https://medium.com/media/03969c91e962589d1f7bce9167b761f4" frameborder=0></iframe>
<p>Now that we have our complete ActiveRecord object we need a method in the Student model to turn it into a CSV.</p>
<iframe src="https://medium.com/media/4e4ea62e36bfe50633efe7a25d8d7cb4" frameborder=0></iframe>
<p>Here we create an array ‘columns’ with the names of the columns in our table we wish to be included in the CSV file. As we renamed the columns in the schools table via the ActiveRecord query (i.e. schools.name as school<em>name) we must now use ‘school</em>name’ and ‘school_address’ to access the data in these columns. We use Ruby’s <a href="https://ruby-doc.org/core-2.2.0/Array.html#method-i-map">map</a> enumerable and Rail’s <a href="http://apidock.com/rails/String/humanize">humanize</a> method to create the first row in the CSV file from the columns array, this will be the title for each column.</p>
<p>Then we use the class method we created earlier with all the data from the tables in the database with the <a href="https://ruby-doc.org/core-2.2.0/Array.html#method-i-each">each</a> enumerable to add a new row for every record in the students table. Now all we need is to be able call this method from within our controller.</p>
<iframe src="https://medium.com/media/21cdddd38c1cbf64134d694631fd8193" frameborder=0></iframe>
<p>You can see from the <em>Rail’s routes</em> that Rail’s standard RESTful routes allow use to use different formats apart from HTML.</p>
<iframe src="https://medium.com/media/31c5a99eaa3493ec67e762daefb6044e" frameborder=0></iframe>
<p>With the <a href="http://api.rubyonrails.org/classes/ActionController/MimeResponds.html">respond_to</a> block we now allow a .csv request to <a href="http://api.rubyonrails.org/classes/ActionController/DataStreaming.html#method-i-send_data">send_data</a> (save a file) from the ‘as_csv’ method we created earlier in the Student model. Now all we need is to include a link within the view of the app so a user can access the method.</p>
<iframe src="https://medium.com/media/d9ce245d3b15b55b0dd1575d70cbd5ad" frameborder=0></iframe>
<p>Which is just a matter of specifying the format in the normal Rail’s <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#method-i-link_to">link_to</a> helper. Now we have everything in place when we click the link we should see…</p>
<p><img src="https://cdn-images-1.medium.com/max/2216/1*IVDd5HJSAqDzW-eokE54Rw.png" alt="Pop up to save the link"><em>Pop up to save the link</em></p>
<p>Once we save an open the file we have all the the data from our tables saved to the local computer and easily viewable in a table like this.</p>
<p><img src="https://cdn-images-1.medium.com/max/4012/1*CJkoXBUQ2m9_6EgjV5NIrw.png" alt="Our CSV table generated through the Rail’s App."><em>Our CSV table generated through the Rail’s App.</em></p>
<h3>Export to XLSX</h3>
<p>The next challenge is to save to an XLSX file. For this will be using the <a href="https://github.com/straydogstudio/axlsx_rails">Axlsx-Rail’s — Spreadsheet templates for Rail’s</a> gem. The first step will be to include the required Gems in the Rail’s App Gemfile…</p>
<iframe src="https://medium.com/media/1bb8449386d3f198394f46f99a356b51" frameborder=0></iframe>
<p>Once added to the Gemfile we must save and run* bundle install* from the terminal. Now we have installed it, it would be wise to look at the <a href="https://github.com/randym/axlsx">readme for the Aslsx gem</a>. You will see it allows you to do quite a lot but there are known issues with Google Docs, Libre Office and Apple Numbers. You should check these and make sure it is the right option for you app.</p>
<p>We will use the <em>all<em>with</em>school_details</em> class method we created in the CSV section to provide the data. This gem requires us to make view with the extension *<em>.xlsx.axlsx</em>. So we will setup the controller to respond to XLSX requests and add a link to <em>index.html.erb</em> like so…</p>
<iframe src="https://medium.com/media/c4a124467444e79f4ca56b40b6d89666" frameborder=0></iframe>
<p>Now it is a matter of creating the view and reading the <a href="http://www.rubydoc.info/github/randym/axlsx/toplevel">documentation</a> to output the XLSX file with the data and format desire. The view extension must be *<em>.xlsx.axlsx *and as we are in the Students#index we will call the file *index.xlsx.axlsx *in the */app/views/students</em> folder which means we are using the Standard Rail’s convention.</p>
<iframe src="https://medium.com/media/7e93f20694272c62a7b725cff4d7ced6" frameborder=0></iframe>
<p>The above code in the view above will style the headings like on the <a href="https://export-csv-sample.herokuapp.com/">website</a>. There is many styling options which can be applied to individual columns and the ability to create multiple sheets in the one file.</p>
<p><img src="https://cdn-images-1.medium.com/max/5168/1*rQcwMEwWWORDrZCG7aZ4Mg.png" alt="The final output of students.xlsx"><em>The final output of students.xlsx</em></p>
<p>Once you click and save the file you can see here the output of the App. It looks very similar to the CSV but the AXSLX gem includes many more features not included in this article and not available with simple CSV file exports.</p>
<h3>Conclusion</h3>
<p>Working with Rail’s conventions makes exporting data from your models straightforward. If you have things you think should be in this tutorial or corrections to help new comers to Rail’s, you can contact me via Twitter @rhysonrails or visit <a href="http://rhysbrooker.com">rhysbrooker.com</a>.</p></div></div><nav class="sc-bZQynM lcKHUK" data-reactid="20"><ul class="sc-gzVnrw iHdjfC" data-reactid="21"><ul class="sc-htoDjs lagtJi" data-reactid="22"><a href="mailto:example@email.com?subject=Email%20from%20RhysBrooker.com" data-reactid="23"><svg width="30px" height="30px" aria-labelledby="simpleicons-mailru-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-reactid="24"><title id="simpleicons-mailru-icon" data-reactid="25">Mail.Ru icon</title><path d="M11.585 5.267c1.834 0 3.558.811 4.824 2.08v.004c0-.609.41-1.068.979-1.068h.145c.891 0 1.073.842 1.073 1.109l.005 9.475c-.063.621.64.941 1.029.543 1.521-1.564 3.342-8.038-.946-11.79-3.996-3.497-9.357-2.921-12.209-.955-3.031 2.091-4.971 6.718-3.086 11.064 2.054 4.74 7.931 6.152 11.424 4.744 1.769-.715 2.586 1.676.749 2.457-2.776 1.184-10.502 1.064-14.11-5.188C-.977 13.521-.847 6.093 5.62 2.245 10.567-.698 17.09.117 21.022 4.224c4.111 4.294 3.872 12.334-.139 15.461-1.816 1.42-4.516.037-4.498-2.031l-.019-.678c-1.265 1.256-2.948 1.988-4.782 1.988-3.625 0-6.813-3.189-6.813-6.812 0-3.659 3.189-6.885 6.814-6.885zm4.561 6.623c-.137-2.653-2.106-4.249-4.484-4.249h-.09c-2.745 0-4.268 2.159-4.268 4.61 0 2.747 1.842 4.481 4.256 4.481 2.693 0 4.464-1.973 4.592-4.306l-.006-.536z" data-reactid="26"></path></svg></a></ul><ul class="sc-htoDjs lagtJi" data-reactid="27"><a href="https://github.com/105ron" data-reactid="28"><svg width="30px" height="30px" aria-labelledby="simpleicons-github-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-reactid="29"><title id="simpleicons-github-icon" data-reactid="30">GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" data-reactid="31"></path></svg></a></ul><ul class="sc-htoDjs lagtJi" data-reactid="32"><a href="https://www.linkedin.com/in/rhysbrooker/" data-reactid="33"><svg width="30px" height="30px" aria-labelledby="simpleicons-linkedin-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-reactid="34"><title id="simpleicons-linkedin-icon" data-reactid="35">LinkedIn icon</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" data-reactid="36"></path></svg></a></ul><ul class="sc-htoDjs lagtJi" data-reactid="37"><a href="https://twitter.com/rhysonrails" data-reactid="38"><svg width="30px" height="30px" aria-labelledby="simpleicons-twitter-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-reactid="39"><title id="simpleicons-twitter-icon" data-reactid="40">Twitter icon</title><path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z" data-reactid="41"></path></svg></a></ul></ul><p class="sc-dnqmqq gnCkus" data-reactid="42">Copyright © All Rights Reserved 2018.</p></nav></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-d1edc8033391b9946162.js","107818501498521":"component---src-templates-blog-post-js-0862630da6e84a3cedd4.js","162898551421021":"component---src-pages-404-js-5680fa8d6d83762bd17c.js","263791100135453":"component---src-pages-about-js-d07c99aab27cd450a397.js","248707572166302":"component---src-pages-blogs-js-bc4890e6a7b7217b364f.js","70144966829960":"component---src-pages-contact-js-733cc10951391c699ff7.js","35783957827783":"component---src-pages-index-js-be127057982e44c5b85d.js","213720915766396":"component---src-pages-projects-js-a5a4cbb83f3e69e55b07.js","60335399758886":"path----557518bd178906f8d58a.js","186439809089793":"path---exporting-data-from-a-rails-appliocation-9beab9bf319a505bf6e2.js","113463288224408":"path---post-three-25c2192390ebef2b052c.js","4430129151547":"path---post-two-3ab4c146e4aaba0f4523.js","157804204402133":"path---post-one-8b83de7c110bc976088f.js","254022195166212":"path---404-a0e39f21c11f6a62c5ab.js","273950069227526":"path---about-a0e39f21c11f6a62c5ab.js","137330578288203":"path---blogs-a0e39f21c11f6a62c5ab.js","184662623972074":"path---contact-a0e39f21c11f6a62c5ab.js","142629428675168":"path---index-c3e528bafa9ca345fcd4.js","97786326051841":"path---projects-a0e39f21c11f6a62c5ab.js","178698757827068":"path---404-html-a0e39f21c11f6a62c5ab.js","114276838955818":"component---src-layouts-index-js-d313dda00df17a1a25a0.js"}/*]]>*/</script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/portfoliosite/commons-961887d3f3b2d16d5e81.js","/portfoliosite/app-d1edc8033391b9946162.js","/portfoliosite/path---exporting-data-from-a-rails-appliocation-9beab9bf319a505bf6e2.js","/portfoliosite/component---src-templates-blog-post-js-0862630da6e84a3cedd4.js","/portfoliosite/component---src-layouts-index-js-d313dda00df17a1a25a0.js"])/*]]>*/</script></body></html>